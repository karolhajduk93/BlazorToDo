@using BlazorToDoApp.Models
@inject AppState AppState

<fieldset class="item">
    <input type="checkbox" class="checkbox" id="@Model.Id" @onchange="ToggleCheckbox" />
    <label title="@(Model.Checked ? "Mark as not completed" : "Mark as completed")" for="@Model.Id" class="@(Model.Checked ? "checkbox-label-checked" : "checkbox-label")">
        <div class="check-sign"></div>
    </label>
    <div class="@(Model.Checked ? "todo-item-text-crossed" : "todo-item-text")"> @Model.Text</div>
    <button title="Delete task" class="delete-button" @onclick="RemoveTodoItem"></button>
    <legend class="date">@Model.Date</legend>
</fieldset>

<br />

@code {
    [Parameter]
    public TodoItemModel Model { get; set; }

    [Parameter]
    public EventCallback<Tuple<TodoItemModel, string>> UpdateHappened { get; set; }

    private void ToggleCheckbox()
    {
        Model.Checked = !Model.Checked;
        Model.IdCompleted = Model.Checked ? TodoItemModel.IdCompletedIncrementer++ : -1;
        UpdateHappened.InvokeAsync(new Tuple<TodoItemModel, string>(Model, "toggle"));
        StateHasChanged();
    }

    private void RemoveTodoItem()
    {
        UpdateHappened.InvokeAsync(new Tuple<TodoItemModel, string>(Model, "remove"));
        StateHasChanged();
    }

}
